---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';

// Get all published blog posts
const allPosts = await getCollection('blog', ({ data }) => !data.draft);

// Get the current post
const { slug } = Astro.params;
const post = allPosts.find((p) => p.slug === slug);

if (!post) {
  return Astro.redirect('/404');
}

const { Content } = await post.render();

// Category colors
const categoryColors: Record<string, string> = {
  'philosophy': '#6366f1',
  'tech': '#06b6d4',
  'personal': '#8b5cf6',
  'other': '#9898b0'
};

const categoryColor = categoryColors[post.data.category] || categoryColors.other;
---

<BaseLayout 
  title={`${post.data.title} - Blog`}
  description={post.data.description || ''}
>
  <Header />
  
  <main class="flex-1 pt-[var(--header-height)] blog-post-page">
    <!-- Hero Section with Side-by-Side Layout -->
    <section class="py-16 px-4">
      <div class="container max-w-6xl">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-start">
          <!-- Left Column: Metadata & Description -->
          <div class="flex flex-col justify-center space-y-6">
            <!-- Category Badge -->
            <div 
              class="inline-block px-4 py-2 text-sm font-bold uppercase tracking-wider text-white self-start"
              style={`background-color: ${categoryColor}`}
            >
              {post.data.category}
            </div>
            
            <!-- Title -->
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-black text-[var(--color-text)] leading-tight">
              {post.data.title}
            </h1>
            
            <!-- Description -->
            {post.data.description && (
              <p class="text-lg md:text-xl text-[var(--color-text-secondary)] font-medium leading-relaxed">
                {post.data.description}
              </p>
            )}
            
            <!-- Meta Info -->
            <div class="space-y-4">
              <time class="block text-sm font-mono text-[var(--color-text-muted)] font-bold uppercase tracking-wide">
                {post.data.date.toLocaleDateString('en-US', { 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric' 
                })}
              </time>
              
              <div class="flex gap-2 flex-wrap">
                {post.data.tags.map(tag => (
                  <span class="px-3 py-1.5 text-xs font-bold uppercase bg-[var(--color-surface)] text-[var(--color-text-secondary)] border-2 border-[var(--color-surface-elevated)]">
                    {tag}
                  </span>
                ))}
              </div>
            </div>
          </div>
          
          <!-- Right Column: Cover Image -->
          {post.data.coverImage && (
            <div class="w-full">
              <div class="relative aspect-[3/2] overflow-hidden border-4 border-[var(--color-surface-elevated)]">
                <img 
                  src={post.data.coverImage} 
                  alt={post.data.coverAlt || post.data.title}
                  class="absolute inset-0 w-full h-full object-cover"
                />
              </div>
            </div>
          )}
        </div>
      </div>
    </section>
    
    <!-- Visual Separator -->
    <div 
      class="h-2 mx-auto max-w-6xl"
      style={`background-color: ${categoryColor}`}
    ></div>

    <!-- Content -->
    <article class="py-16 px-4">
      <div class="container max-w-3xl prose-brutalist">
        <Content />
      </div>
    </article>

    <!-- Back to Blog -->
    <section class="py-12 px-4 border-t-4 border-[var(--color-surface-elevated)]">
      <div class="container max-w-3xl">
        <a 
          href="/blog"
          class="inline-flex items-center gap-2 px-6 py-3 text-sm font-bold uppercase bg-[var(--color-primary)] text-white hover:opacity-90 transition-opacity"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" />
          </svg>
          Back to Blog
        </a>
      </div>
    </section>
  </main>
  
  <Footer />
</BaseLayout>

<style>
  .blog-post-page {
    background: var(--color-background);
  }

  /* Brutalist Prose Styling */
  .prose-brutalist {
    color: var(--color-text);
  }

  .prose-brutalist :global(h1),
  .prose-brutalist :global(h2),
  .prose-brutalist :global(h3),
  .prose-brutalist :global(h4) {
    font-weight: 900;
    color: var(--color-text);
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.2;
  }

  .prose-brutalist :global(h1) {
    font-size: 2.5rem;
    border-left: 8px solid var(--color-primary);
    padding-left: 1rem;
  }

  .prose-brutalist :global(h2) {
    font-size: 2rem;
    border-left: 6px solid var(--color-accent);
    padding-left: 1rem;
  }

  .prose-brutalist :global(h3) {
    font-size: 1.5rem;
  }

  .prose-brutalist :global(p) {
    font-size: 1.125rem;
    line-height: 1.8;
    margin-bottom: 1.5rem;
    color: var(--color-text-secondary);
  }

  .prose-brutalist :global(strong) {
    font-weight: 800;
    color: var(--color-text);
  }

  .prose-brutalist :global(em) {
    font-style: italic;
    color: var(--color-primary);
  }

  .prose-brutalist :global(a) {
    color: var(--color-accent);
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 4px;
    font-weight: 600;
  }

  .prose-brutalist :global(a:hover) {
    color: var(--color-primary);
  }

  .prose-brutalist :global(ul),
  .prose-brutalist :global(ol) {
    margin: 1.5rem 0;
    padding-left: 2rem;
  }

  .prose-brutalist :global(li) {
    font-size: 1.125rem;
    line-height: 1.8;
    margin-bottom: 0.5rem;
    color: var(--color-text-secondary);
  }

  .prose-brutalist :global(code) {
    font-family: var(--font-mono);
    background: var(--color-surface);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.9em;
    color: var(--color-accent);
    font-weight: 600;
  }

  .prose-brutalist :global(pre) {
    background: var(--color-surface);
    border-left: 4px solid var(--color-primary);
    padding: 1.5rem;
    margin: 2rem 0;
    overflow-x: auto;
    font-size: 0.95rem;
  }

  .prose-brutalist :global(pre code) {
    background: none;
    padding: 0;
    color: var(--color-text);
  }

  .prose-brutalist :global(blockquote) {
    border-left: 6px solid var(--color-accent);
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--color-text);
    font-size: 1.25rem;
  }

  .prose-brutalist :global(img) {
    width: 100%;
    height: auto;
    margin: 2rem 0;
    border-left: 6px solid var(--color-primary);
  }

  .prose-brutalist :global(figure) {
    margin: 2rem 0;
  }

  .prose-brutalist :global(figcaption) {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    font-style: italic;
    color: var(--color-text-muted);
    text-align: center;
  }
</style>
