---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';
import { getCategoryColor } from '../../lib/constants';

// Get all published blog posts sorted by date
const allPosts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout 
  title="Blog - Godot"
  description="Thoughts on tech, philosophy, and everything in between"
>
  <Header />
  
  <main class="flex-1 pt-[var(--header-height)] blog-page">
    <!-- Hero Section -->
    <section class="py-20 px-4 border-b border-[var(--color-surface)]">
      <div class="container max-w-4xl">
        <h1 class="text-6xl md:text-8xl font-black mb-6 text-[var(--color-text)] leading-none">
          Blog
        </h1>
        <p class="text-xl md:text-2xl text-[var(--color-text-secondary)] font-medium">
          Thoughts on tech, philosophy, and everything in between
        </p>
      </div>
    </section>

    <!-- Blog Listing -->
    <section class="py-16 px-4">
      <div class="container max-w-6xl">
        {/* Featured Post (First Post - Full Width) */}
        {allPosts[0] && (
          <article class="blog-post-card group mb-16">
            {(() => {
              const post = allPosts[0];
              const categoryColor = getCategoryColor(post.data.category);
              return (
                <>
                  <!-- Category Tag with Bold Color -->
                  <div 
                    class="inline-block px-4 py-2 mb-4 text-sm font-bold uppercase tracking-wider text-white"
                    style={`background-color: ${categoryColor}`}
                  >
                    {post.data.category}
                  </div>
                  
                  <!-- Cover Image (if exists) -->
                  {post.data.coverImage && (
                    <a href={`/blog/${post.slug}`} class="block mb-6 overflow-hidden">
                      <img 
                        src={post.data.coverImage} 
                        alt={post.data.coverAlt || post.data.title}
                        class="w-full h-64 object-cover transition-transform duration-300 group-hover:scale-105"
                        style={`border-left: 8px solid ${categoryColor}`}
                      />
                    </a>
                  )}
                  
                  <!-- Post Content -->
                  <a 
                    href={`/blog/${post.slug}`}
                    class="block"
                  >
                    <h2 class="text-3xl md:text-5xl font-black mb-4 text-[var(--color-text)] leading-tight group-hover:text-[var(--color-primary)] transition-colors">
                      {post.data.title}
                    </h2>
                    
                    <p class="text-lg text-[var(--color-text-secondary)] mb-6 leading-relaxed">
                      {post.data.description}
                    </p>
                    
                    <div class="flex items-center justify-between flex-wrap gap-4">
                      <time class="text-sm font-mono text-[var(--color-text-muted)]">
                        {post.data.date.toLocaleDateString('en-US', { 
                          year: 'numeric', 
                          month: 'long', 
                          day: 'numeric' 
                        })}
                      </time>
                      
                      <div class="flex gap-2 flex-wrap">
                        {post.data.tags.map(tag => (
                          <span class="px-3 py-1 text-xs font-bold uppercase bg-[var(--color-surface)] text-[var(--color-text-secondary)] border-2 border-[var(--color-surface-elevated)]">
                            {tag}
                          </span>
                        ))}
                      </div>
                    </div>
                  </a>
                  
                  <!-- Bold Separator -->
                  <div 
                    class="h-1 mt-12"
                    style={`background-color: ${categoryColor}`}
                  />
                </>
              );
            })()}
          </article>
        )}

        {/* Remaining Posts - 2 Column Grid */}
        {allPosts.length > 1 && (
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
            {allPosts.slice(1).map((post) => {
              const categoryColor = getCategoryColor(post.data.category);
              
              return (
                <article class="blog-post-card group">
                  <!-- Category Tag with Bold Color -->
                  <div 
                    class="inline-block px-4 py-2 mb-4 text-sm font-bold uppercase tracking-wider text-white"
                    style={`background-color: ${categoryColor}`}
                  >
                    {post.data.category}
                  </div>
                  
                  <!-- Cover Image (if exists) -->
                  {post.data.coverImage && (
                    <a href={`/blog/${post.slug}`} class="block mb-6 overflow-hidden">
                      <img 
                        src={post.data.coverImage} 
                        alt={post.data.coverAlt || post.data.title}
                        class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105"
                        style={`border-left: 8px solid ${categoryColor}`}
                      />
                    </a>
                  )}
                  
                  <!-- Post Content -->
                  <a 
                    href={`/blog/${post.slug}`}
                    class="block"
                  >
                    <h2 class="text-2xl md:text-3xl font-black mb-4 text-[var(--color-text)] leading-tight group-hover:text-[var(--color-primary)] transition-colors">
                      {post.data.title}
                    </h2>
                    
                    <p class="text-base text-[var(--color-text-secondary)] mb-6 leading-relaxed">
                      {post.data.description}
                    </p>
                    
                    <div class="space-y-3">
                      <time class="block text-sm font-mono text-[var(--color-text-muted)]">
                        {post.data.date.toLocaleDateString('en-US', { 
                          year: 'numeric', 
                          month: 'long', 
                          day: 'numeric' 
                        })}
                      </time>
                      
                      <div class="flex gap-2 flex-wrap">
                        {post.data.tags.map(tag => (
                          <span class="px-3 py-1 text-xs font-bold uppercase bg-[var(--color-surface)] text-[var(--color-text-secondary)] border-2 border-[var(--color-surface-elevated)]">
                            {tag}
                          </span>
                        ))}
                      </div>
                    </div>
                  </a>
                  
                  <!-- Bold Separator -->
                  <div 
                    class="h-1 mt-8"
                    style={`background-color: ${categoryColor}`}
                  />
                </article>
              );
            })}
          </div>
        )}
      </div>
    </section>
  </main>
  
  <Footer />
</BaseLayout>

<style>
  .blog-page {
    background: var(--color-background);
  }

  .blog-post-card {
    position: relative;
  }

  .blog-post-card:hover h2 {
    transform: translateX(4px);
    transition: transform 200ms ease;
  }
</style>
